<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ØµØ­ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#050510">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['IBM Plex Sans Arabic', 'sans-serif'] },
                    colors: {
                        navy: { 900: '#050510', 800: '#0f1219', 700: '#1a1d26' },
                        gold: { 400: '#D4AF37', 500: '#C5A028' }
                    },
                    animation: { 'marquee': 'marquee 30s linear infinite' },
                    keyframes: { marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050510; color: #f3f4f6; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .nav-item.active { border-bottom: 2px solid #D4AF37; color: #D4AF37; }
        .sidebar { transition: transform 0.3s ease-in-out; transform: translateX(100%); }
        .sidebar.open { transform: translateX(0); }
        .glass-header { background: rgba(5, 5, 16, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: #D4AF37; width: 24px; height: 24px; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .view-hidden { display: none !important; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- HEADER & NAVIGATION (Sticky) -->
    <header class="fixed top-0 w-full z-50 glass-header">
        <div class="container mx-auto px-4 h-16 flex justify-between items-center">
            
            <!-- Logo -->
            <div class="flex items-center gap-3" onclick="window.location.reload()">
                <div class="text-2xl font-black text-white tracking-tighter">
                    Ø§Ù„Ù€Ø­Ù‚ÙŠÙ‚Ø©<span class="text-gold-400">.</span>
                </div>
            </div>

            <!-- Search & Menu -->
            <div class="flex items-center gap-4">
                <button class="text-gray-400 hover:text-white"><i data-lucide="search" class="w-5 h-5"></i></button>
                <button onclick="toggleSidebar()" class="text-white focus:outline-none"><i data-lucide="menu" class="w-7 h-7"></i></button>
            </div>
        </div>

        <!-- Public Menu (News Categories Only) -->
        <div class="w-full overflow-x-auto scrollbar-hide bg-navy-800 border-b border-white/5">
            <div class="flex px-4 min-w-max">
                <button onclick="switchPublicView('home', this)" class="nav-item active px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button onclick="switchPublicView('local', this)" class="nav-item px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©</button>
                <button onclick="switchPublicView('articles', this)" class="nav-item px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ù…Ù‚Ø§Ù„Ø§Øª</button>
                <button onclick="switchPublicView('reports', this)" class="nav-item px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">ØªÙ‚Ø§Ø±ÙŠØ±</button>
            </div>
        </div>
    </header>

    <!-- SIDEBAR MENU -->
    <aside id="main-sidebar" class="sidebar fixed inset-y-0 right-0 w-72 bg-[#1a1d26] z-[60] shadow-2xl border-l border-white/10 overflow-y-auto">
        <div class="p-5 border-b border-white/10 flex justify-between items-center">
            <h2 class="text-lg font-bold text-white">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
            <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <div class="p-4 space-y-2">
            <button onclick="switchPublicView('home'); toggleSidebar()" class="w-full flex items-center gap-2 py-3 text-gray-300 hover:text-gold-400 font-bold border-b border-white/5">
                <i data-lucide="home" class="w-4 h-4"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            <button onclick="toggleAdminView(); toggleSidebar()" class="w-full flex items-center gap-2 py-3 text-gold-400 hover:text-white font-bold mt-4 bg-white/5 rounded px-3">
                <i data-lucide="shield" class="w-4 h-4"></i> Ø¯Ø®ÙˆÙ„ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ØµØ­ÙŠÙØ© (Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
            </button>
        </div>
    </aside>
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-50 hidden backdrop-blur-sm"></div>

    <!-- PUBLIC CONTENT AREA -->
    <main id="public-content" class="pt-32 pb-20 container mx-auto px-4 min-h-screen">
        <!-- Ticker -->
        <div class="bg-navy-800 border border-white/5 rounded-lg p-2 mb-6 flex items-center gap-3 shadow-lg">
            <span class="bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded animate-pulse">Ø¹Ø§Ø¬Ù„</span>
            <div class="w-full overflow-hidden relative h-5">
                <div id="ticker-content" class="absolute whitespace-nowrap animate-marquee text-xs text-gray-300 pt-0.5">
                    Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ© | ØªØµÙ…ÙŠÙ… ÙˆØ¥Ø´Ø±Ø§Ù: ÙŠÙˆØ³Ù Ø§Ù„Ø¹ØªÙŠ ... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...
                </div>
            </div>
        </div>

        <div id="hero-section" class="mb-8 relative h-[400px] rounded-2xl bg-white/5 animate-pulse flex items-center justify-center border border-white/5">
            <div class="loader"></div>
        </div>

        <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="h-64 bg-white/5 rounded-xl animate-pulse"></div>
            <div class="h-64 bg-white/5 rounded-xl animate-pulse"></div>
        </div>
    </main>

    <!-- ADMIN DASHBOARD (The Command Room) -->
    <div id="admin-view" class="view-hidden fixed inset-0 z-[70] bg-[#050510] w-full h-full overflow-y-auto">
        
        <!-- Login Gate -->
        <div id="login-gate" class="min-h-screen flex items-center justify-center p-4">
            <div class="glass-panel p-10 rounded-3xl w-full max-w-md text-center relative border border-gold-400/20 shadow-2xl bg-navy-800">
                <button onclick="toggleAdminView()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
                <h1 class="text-3xl font-bold text-white mb-2">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h1>
                <form onsubmit="handleRealLogin(event)" class="space-y-6 mt-6">
                    <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø±Ø³Ù…ÙŠ" class="w-full bg-[#0a0a15] border border-white/10 rounded-xl py-3 px-4 text-white focus:border-gold-400 outline-none">
                    <input type="password" id="login-password" placeholder="Ø§Ù„Ø´ÙØ±Ø©" class="w-full bg-[#0a0a15] border border-white/10 rounded-xl py-3 px-4 text-white focus:border-gold-400 outline-none">
                    <button class="w-full bg-gold-400 text-black font-bold py-4 rounded-xl hover:bg-white transition shadow-lg">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                </form>
            </div>
        </div>

        <!-- Admin UI -->
        <div id="dashboard-ui" class="hidden min-h-screen flex flex-col lg:flex-row">
            <!-- Admin Sidebar -->
            <aside class="w-full lg:w-72 bg-navy-900 border-l border-white/5 flex flex-col z-20">
                <div class="h-16 flex items-center justify-between px-6 border-b border-white/5">
                    <h2 class="text-xl font-bold text-white">ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
                    <button onclick="toggleAdminView()" class="lg:hidden text-gray-400"><i data-lucide="x"></i></button>
                </div>
                <div class="flex-1 p-4 space-y-1 overflow-y-auto">
                    
                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
                    <button onclick="switchDashView('editor', this)" class="sidebar-link active w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="pen-tool" class="w-4 h-4"></i> Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø°ÙƒÙŠ</button>
                    <button onclick="switchDashView('articles', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="file-text" class="w-4 h-4"></i> Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
                    
                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2 mt-2">Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© (Ø¬Ø¯ÙŠØ¯)</p>
                    <button onclick="switchDashView('innovations', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="lightbulb" class="w-4 h-4 text-gold-400"></i> Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ø§Ù„Ù€ 15</button>
                    <button onclick="switchDashView('impact', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="bar-chart-2" class="w-4 h-4 text-blue-400"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø«Ø±</button>
                    
                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2 mt-2">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</p>
                    <button onclick="switchDashView('hr', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="users" class="w-4 h-4"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
                    <button onclick="switchDashView('contract', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="file-signature" class="w-4 h-4"></i> Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù‚Ø¯</button>

                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2 mt-2">Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    <button onclick="switchDashView('settings', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="settings" class="w-4 h-4"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…ÙØªØ§Ø­ AI)</button>
                </div>
                <div class="p-4 border-t border-white/5">
                    <button onclick="logout()" class="w-full flex items-center justify-center gap-2 text-red-400 hover:bg-red-400/10 text-xs py-2 rounded-lg transition"><i data-lucide="log-out" class="w-3 h-3"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>
            </aside>

            <div class="flex-1 bg-[#020205] overflow-y-auto p-6">
                
                <!-- 1. Editor Tab -->
                <div id="sec-editor" class="view-section max-w-4xl mx-auto space-y-6">
                    <h2 class="text-2xl font-bold text-white">Ù†Ø´Ø± Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</h2>
                    <input type="text" id="news-title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†..." class="w-full bg-transparent text-3xl font-bold text-white border-none focus:ring-0 px-0">
                    <textarea id="editor" class="w-full h-64 bg-navy-800 border border-white/10 rounded-xl p-4 text-white" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰..."></textarea>
                    <button onclick="publishAction()" id="publish-btn" class="w-full bg-gold-400 text-black font-bold py-3 rounded-lg">Ù†Ø´Ø± ğŸš€</button>
                </div>

                <!-- 2. Innovations Tab (Moved inside) -->
                <div id="sec-innovations" class="view-section hidden space-y-6">
                    <h2 class="text-2xl font-bold text-white mb-4 border-r-4 border-gold-400 pr-3">Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ø§Ù„Ù€ 15</h2>
                    <div id="features-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- 3. Impact Dashboard Tab (Moved inside) -->
                <div id="sec-impact" class="view-section hidden space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-gold-400 text-center"><h3 class="text-gray-400 text-xs">Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ†Ø¨Ø¤</h3><p class="text-2xl font-bold text-white">85%</p></div>
                        <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-blue-400 text-center"><h3 class="text-gray-400 text-xs">Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h3><p class="text-2xl font-bold text-white">12.5K</p></div>
                    </div>
                    <div class="bg-navy-800 p-4 rounded-xl border border-white/5 h-64 flex items-center justify-center">
                        <canvas id="predictiveChart"></canvas>
                    </div>
                </div>

                <!-- 4. Contract Tab (Moved inside) -->
                <div id="sec-contract" class="view-section hidden max-w-2xl mx-auto">
                     <div class="bg-navy-800 p-6 rounded-xl border border-white/10">
                        <h3 class="text-white font-bold mb-4">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h3>
                        <p class="text-gray-400 text-sm mb-4">Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…ÙˆØ¸Ù Ø¹Ù†Ø¯ ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙˆØ¸ÙŠÙ.</p>
                        <div class="bg-black/30 p-4 rounded text-xs text-gray-500 h-40 overflow-y-auto">
                            Ù†Øµ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ... Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰... Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©... (Ù†Ø³Ø®Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
                        </div>
                    </div>
                </div>
                
                <!-- 5. HR Tab -->
                <div id="sec-hr" class="view-section hidden max-w-4xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                         <h2 class="text-2xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ§Ø¯Ø±</h2>
                         <button onclick="generateInviteLink()" class="bg-gold-400 text-black px-4 py-2 rounded-lg font-bold text-sm">ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· ØªÙˆØ¸ÙŠÙ</button>
                    </div>
                    <div id="invite-box" class="hidden bg-white/10 p-4 rounded-xl mb-6">
                        <p class="text-xs text-gold-400">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©:</p>
                        <input type="text" id="invite-link-val" readonly class="w-full bg-transparent text-white text-xs">
                    </div>
                </div>

                <!-- 6. Settings Tab -->
                <div id="sec-settings" class="view-section hidden max-w-md mx-auto">
                    <h3 class="text-white font-bold mb-4">Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                    <input type="password" id="api-key-setting" class="w-full bg-navy-800 border border-white/10 rounded p-3 text-white">
                    <button onclick="saveApiKey()" class="mt-4 w-full bg-gold-400 text-black font-bold py-2 rounded">Ø­ÙØ¸</button>
                </div>

                <!-- Archive Tab -->
                <div id="sec-articles" class="view-section hidden">
                    <div id="admin-articles-list" class="space-y-2"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 left-6 bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-all z-[100] font-bold">ØªÙ…</div>

    <script>
        function initIcons() { if (window.lucide) lucide.createIcons(); }
        document.addEventListener('DOMContentLoaded', () => { initIcons(); fetchNews(); renderFeatures(); });

        // Firebase Config
        const firebaseConfig = { apiKey: "AIzaSyD7b1PZY26GN6hR2pliqiFRgyMsNyRlWOs", authDomain: "alhqyqa-62b0e.firebaseapp.com", projectId: "alhqyqa-62b0e", storageBucket: "alhqyqa-62b0e.firebasestorage.app", messagingSenderId: "354014970954", appId: "1:354014970954:web:435ca4eb0cbbfcfd1152b3" };
        let isOfflineMode = false;
        const LOCAL_NEWS_KEY = "local_news_db";
        let db, auth;

        // Features Data
        const featuresData = [
            { icon: 'ğŸ‘»', title: 'Ø§Ù„Ù…Ø±Ø§Ø³Ù„ Ø§Ù„Ø´Ø¨Ø­', desc: 'Ù†Ø´Ø± Ø¢Ù„ÙŠ' },
            { icon: 'ğŸ”®', title: 'Ø§Ù„ØºØ±ÙØ© Ø§Ù„ØªÙ†Ø¨Ø¤ÙŠØ©', desc: 'ØªÙˆÙ‚Ø¹ Ø§Ù„ØªØ±ÙŠÙ†Ø¯' },
            { icon: 'ğŸ“', title: 'Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±', desc: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ±' },
             // ... Add rest if needed
        ];

        function renderFeatures() {
            const grid = document.getElementById('features-grid');
            if(grid) grid.innerHTML = featuresData.map(f => `
                <div class="bg-white/5 p-4 rounded-xl border border-white/10">
                    <div class="text-2xl mb-2">${f.icon}</div>
                    <h3 class="text-white font-bold text-sm">${f.title}</h3>
                    <p class="text-gray-500 text-xs">${f.desc}</p>
                </div>
            `).join('');
        }

        // Firebase Init
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            
            auth.onAuthStateChanged(user => {
                if(user && !user.isAnonymous) {
                    document.getElementById('login-gate').classList.add('hidden');
                    document.getElementById('dashboard-ui').classList.remove('hidden');
                    loadAdminData();
                }
            });
            if(!auth.currentUser) auth.signInAnonymously().catch(()=>isOfflineMode=true);
        } catch(e) { isOfflineMode=true; }

        // News Logic
        function getLocalNews() { try { return JSON.parse(localStorage.getItem(LOCAL_NEWS_KEY) || "[]"); } catch { return []; } }
        async function fetchNews() {
            if (isOfflineMode) return renderLocal();
            try {
                const snap = await db.collection("news").limit(20).get();
                if(snap.empty) renderLocal();
                else {
                    const data = snap.docs.map(d => ({id:d.id, ...d.data()}));
                    renderSite(data);
                }
            } catch(e) { renderLocal(); }
        }
        function renderLocal() {
            const l = getLocalNews();
            if(l.length) renderSite(l);
            else {
                const m = [{id:1, title:"ØµØ­ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ØªØ·Ù„Ù‚ Ù‡ÙˆÙŠØªÙ‡Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", category:"Ø¹Ø§Ù…", img:"https://images.unsplash.com/photo-1504711434969-e33886168f5c", desc:"Ù†Ù‚Ù„Ø© Ù†ÙˆØ¹ÙŠØ©..."}];
                renderSite(m);
            }
        }
        function renderSite(news) {
            if(!news.length) return;
            const hero = news[0];
            const rest = news.slice(1);
            
            document.getElementById('ticker-content').innerText = "Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ© | ØªØµÙ…ÙŠÙ…: ÙŠÙˆØ³Ù Ø§Ù„Ø¹ØªÙŠ â€¢ " + news.map(n => n.title).join(" â€¢ ");
            
            document.getElementById('hero-section').innerHTML = `
                <div class="w-full h-full relative group overflow-hidden rounded-2xl cursor-pointer shadow-2xl">
                    <img src="${hero.img}" class="w-full h-full object-cover transition duration-700 group-hover:scale-105">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                    <div class="absolute bottom-0 p-8">
                        <span class="bg-gold-400 text-black text-xs font-bold px-3 py-1 rounded-full mb-3 inline-block">${hero.category}</span>
                        <h1 class="text-3xl font-bold text-white mb-2">${hero.title}</h1>
                    </div>
                </div>`;

            document.getElementById('news-container').innerHTML = rest.map(n => `
                <div class="flex gap-4 bg-white/5 p-3 rounded-xl border border-white/5 hover:border-gold-400/30 cursor-pointer transition">
                    <div class="w-24 h-24 rounded-lg overflow-hidden shrink-0"><img src="${n.img}" class="w-full h-full object-cover"></div>
                    <div class="flex flex-col justify-center"><h3 class="text-white font-bold text-sm line-clamp-2">${n.title}</h3><span class="text-[10px] text-gold-400 mt-2">${n.category}</span></div>
                </div>`).join('');
            initIcons();
        }

        // Admin Logic
        window.handleRealLogin = async (e) => {
            e.preventDefault();
            const em = document.getElementById('login-email').value;
            const ps = document.getElementById('login-password').value;
            try { await auth.signInWithEmailAndPassword(em, ps); } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„"); }
        };

        window.publishAction = async () => {
            const title = document.getElementById('news-title').value;
            const cat = document.getElementById('news-category').value;
            const content = document.getElementById('editor').value;
            const art = { id:"loc_"+Date.now(), title, category: cat, img:"https://via.placeholder.com/800", desc:content, date: new Date().toLocaleDateString('ar-SA') };
            
            try { await db.collection("news").add(art); showToast("ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ…"); }
            catch { 
                const l = getLocalNews(); l.unshift(art); localStorage.setItem(LOCAL_NEWS_KEY, JSON.stringify(l));
                showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ âš ï¸");
            }
            fetchNews();
        };

        // Navigation
        window.toggleSidebar = () => {
            document.getElementById('main-sidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('hidden');
        };
        window.toggleAdminView = () => {
            const admin = document.getElementById('admin-view');
            const pub = document.getElementById('public-view');
            if(admin.classList.contains('view-hidden')) {
                admin.classList.remove('view-hidden');
                pub.classList.add('view-hidden');
            } else {
                admin.classList.add('view-hidden');
                pub.classList.remove('view-hidden');
            }
        };

        window.switchPublicView = (view, btn) => {
             // For now, this just filters news or scrolls, keeping it simple for SPA
             if(view === 'home') window.location.reload();
             // In a real app, this would filter the news array
        };

        window.switchDashView = (v, btn) => {
            document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden'));
            document.getElementById('sec-'+v).classList.remove('hidden');
            document.querySelectorAll('.sidebar-link').forEach(e => e.classList.remove('active'));
            btn.classList.add('active');
            if(v==='impact') initCharts();
        };

        window.generateInviteLink = () => {
            const id = "HQ-"+Math.floor(Math.random()*9000);
            const link = window.location.href.split('?')[0] + "?mode=recruitment&jobId="+id;
            document.getElementById('invite-box').classList.remove('hidden');
            document.getElementById('invite-link-val').value = link;
        }
        
        // Settings
        window.openSettings = () => document.getElementById('settings-modal').classList.remove('hidden');
        window.saveApiKey = () => { 
            const k = document.getElementById('api-key-input').value; 
            if(k) { localStorage.setItem("gemini_api_key", k); document.getElementById('settings-modal').classList.add('hidden'); }
        };

        function showToast(msg) {
            const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('opacity-0', 'translate-y-24');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-24'), 3000);
        }

        function initCharts() {
             const ctx = document.getElementById('predictiveChart');
             if(ctx) new Chart(ctx, { type: 'line', data: { labels: ['A','B','C'], datasets: [{ label: 'Trend', data: [10, 20, 15], borderColor: '#D4AF37' }] } });
        }
    </script>
</body>
</html>



<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ØµØ­ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#050510">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['IBM Plex Sans Arabic', 'sans-serif'] },
                    colors: {
                        navy: { 900: '#050510', 800: '#0f1219', 700: '#1a1d26' },
                        gold: { 400: '#D4AF37', 500: '#C5A028' }
                    },
                    animation: { 'marquee': 'marquee 30s linear infinite' },
                    keyframes: { marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050510; color: #f3f4f6; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* Scrollbar hide for menu */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Accordion Animation */
        .accordion-content { transition: max-height 0.3s ease-out, opacity 0.3s ease-out; max-height: 0; opacity: 0; overflow: hidden; }
        .accordion-content.open { max-height: 500px; opacity: 1; }
        
        /* Active Nav Item */
        .nav-item.active { border-bottom: 2px solid #D4AF37; color: #D4AF37; }
        
        /* Sidebar Transition */
        .sidebar { transition: transform 0.3s ease-in-out; transform: translateX(100%); }
        .sidebar.open { transform: translateX(0); }
        
        .glass-header { background: rgba(5, 5, 16, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: #D4AF37; width: 24px; height: 24px; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- HEADER & NAVIGATION (Sticky) -->
    <header class="fixed top-0 w-full z-50 glass-header">
        <!-- Top Bar: Logo & Menu Trigger -->
        <div class="container mx-auto px-4 h-16 flex justify-between items-center">
            
            <!-- Logo (Right) -->
            <div class="flex items-center gap-3" onclick="window.location.reload()">
                <div class="text-2xl font-black text-white tracking-tighter">
                    Ø§Ù„Ù€Ø­Ù‚ÙŠÙ‚Ø©<span class="text-gold-400">.</span>
                </div>
            </div>

            <!-- Search & Menu (Left) -->
            <div class="flex items-center gap-4">
                <button class="text-gray-400 hover:text-white"><i data-lucide="search" class="w-5 h-5"></i></button>
                
                <!-- Hamburger Menu Trigger -->
                <button onclick="toggleSidebar()" class="text-white focus:outline-none">
                    <i data-lucide="menu" class="w-7 h-7"></i>
                </button>
            </div>
        </div>

        <!-- Horizontal Scroll Menu (Like Screenshot 1) -->
        <div class="w-full overflow-x-auto scrollbar-hide bg-navy-800 border-b border-white/5">
            <div class="flex px-4 min-w-max">
                <button onclick="switchView('home', this)" class="nav-item active px-4 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button onclick="switchView('features', this)" class="nav-item px-4 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ø§Ù„Ù€ 15</button>
                <button onclick="switchView('contract', this)" class="nav-item px-4 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¹Ù‚Ø¯</button>
                <button onclick="switchView('dashboard', this)" class="nav-item px-4 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø«Ø±</button>
                <button onclick="switchView('admin', this)" class="nav-item px-4 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">ØºØ±ÙØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</button>
            </div>
        </div>
    </header>

    <!-- SIDEBAR MENU (Like Screenshot 2) -->
    <aside id="main-sidebar" class="sidebar fixed inset-y-0 right-0 w-72 bg-[#1a1d26] z-[60] shadow-2xl border-l border-white/10 overflow-y-auto">
        <div class="p-5 border-b border-white/10 flex justify-between items-center">
            <h2 class="text-lg font-bold text-white">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>

        <div class="p-4 space-y-2">
            <!-- Accordion Item 1: Admin -->
            <div class="border-b border-white/5 pb-2">
                <button onclick="toggleAccordion('acc-admin')" class="w-full flex justify-between items-center py-3 text-gray-300 hover:text-gold-400 font-bold">
                    <span class="flex items-center gap-2"><i data-lucide="shield" class="w-4 h-4"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
                    <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-300" id="icon-acc-admin"></i>
                </button>
                <div id="acc-admin" class="accordion-content bg-black/20 rounded-lg">
                    <a href="#" onclick="switchView('admin'); toggleSidebar()" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø°ÙƒÙŠ</a>
                    <a href="#" onclick="switchView('admin'); toggleSidebar()" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (HR)</a>
                    <a href="#" onclick="switchView('admin'); toggleSidebar()" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ø§Ù„Ø£Ø±Ø´ÙŠÙ</a>
                </div>
            </div>

            <!-- Accordion Item 2: Settings -->
            <div class="border-b border-white/5 pb-2">
                <button onclick="toggleAccordion('acc-settings')" class="w-full flex justify-between items-center py-3 text-gray-300 hover:text-gold-400 font-bold">
                    <span class="flex items-center gap-2"><i data-lucide="settings" class="w-4 h-4"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-300" id="icon-acc-settings"></i>
                </button>
                <div id="acc-settings" class="accordion-content bg-black/20 rounded-lg">
                    <a href="#" onclick="openSettings(); toggleSidebar()" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</a>
                    <a href="#" onclick="toggleReaderAuth(); toggleSidebar()" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ø­Ø³Ø§Ø¨ÙŠ</a>
                </div>
            </div>

            <!-- Accordion Item 3: Modules -->
            <div class="border-b border-white/5 pb-2">
                <button onclick="toggleAccordion('acc-modules')" class="w-full flex justify-between items-center py-3 text-gray-300 hover:text-gold-400 font-bold">
                    <span class="flex items-center gap-2"><i data-lucide="box" class="w-4 h-4"></i> Ø§Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„Ø§Øª</span>
                    <i data-lucide="chevron-down" class="w-4 h-4 transition-transform duration-300" id="icon-acc-modules"></i>
                </button>
                <div id="acc-modules" class="accordion-content bg-black/20 rounded-lg">
                    <a href="#" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ø§Ù„Ø¨Ù†Ø±Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©</a>
                    <a href="#" class="block px-4 py-2 text-sm text-gray-400 hover:text-white hover:bg-white/5 rounded">Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ©</a>
                </div>
            </div>
            
            <!-- Single Links -->
            <button onclick="switchView('home'); toggleSidebar()" class="w-full flex items-center gap-2 py-3 text-gray-300 hover:text-gold-400 font-bold border-b border-white/5">
                <i data-lucide="home" class="w-4 h-4"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            
            <button onclick="logout()" class="w-full flex items-center gap-2 py-3 text-red-400 hover:text-red-300 font-bold mt-4">
                <i data-lucide="log-out" class="w-4 h-4"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </aside>

    <!-- OVERLAY (Background Dim) -->
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-50 hidden backdrop-blur-sm"></div>

    <!-- MAIN CONTENT AREA -->
    <main class="pt-32 pb-20 container mx-auto px-4 min-h-screen">
        
        <!-- 1. HOME VIEW (News) -->
        <section id="view-home" class="view-section">
            <!-- Ticker -->
            <div class="bg-navy-800 border border-white/5 rounded-lg p-2 mb-6 flex items-center gap-3 shadow-lg">
                <span class="bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded animate-pulse">Ø¹Ø§Ø¬Ù„</span>
                <div class="w-full overflow-hidden relative h-5">
                    <div id="ticker-content" class="absolute whitespace-nowrap animate-marquee text-xs text-gray-300 pt-0.5">
                        Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ© | ØªØµÙ…ÙŠÙ… ÙˆØ¥Ø´Ø±Ø§Ù: ÙŠÙˆØ³Ù Ø§Ù„Ø¹ØªÙŠ ... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...
                    </div>
                </div>
            </div>

            <div id="hero-section" class="mb-8 relative h-[400px] rounded-2xl bg-white/5 animate-pulse flex items-center justify-center border border-white/5">
                <div class="loader"></div>
            </div>

            <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- News Items -->
            </div>
        </section>

        <!-- 2. FEATURES VIEW -->
        <section id="view-features" class="view-section hidden">
            <h2 class="text-2xl font-bold text-white mb-6 border-r-4 border-gold-400 pr-3">Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ø§Ù„Ù€ 15</h2>
            <div id="features-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </section>

        <!-- 3. CONTRACT VIEW -->
        <section id="view-contract" class="view-section hidden max-w-2xl mx-auto">
            <div class="bg-navy-800 border border-white/10 rounded-2xl p-6 shadow-2xl">
                <h2 class="text-2xl font-bold text-white mb-4 text-center">Ø¹Ù‚Ø¯ ØªÙˆØ¸ÙŠÙ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h2>
                <p class="text-gray-400 text-sm text-center mb-6">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ: <span class="text-gold-400 font-mono">HQ-GEN-01</span></p>
                <form onsubmit="submitEmployeeContract(event)" class="space-y-4">
                    <input type="text" id="rec-name" required class="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:border-gold-400 outline-none" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
                    <input type="text" id="rec-id" required class="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:border-gold-400 outline-none" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© (1xxxxxxxxx)">
                    <button class="w-full bg-gold-400 text-black font-bold py-3 rounded-lg hover:bg-white transition">ØªÙˆØ«ÙŠÙ‚ Ø¨Ø§Ù„Ø¨ØµÙ…Ø©</button>
                </form>
            </div>
        </section>

        <!-- 4. DASHBOARD VIEW -->
        <section id="view-dashboard" class="view-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-gold-400 text-center"><h3 class="text-gray-400 text-xs">Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ†Ø¨Ø¤</h3><p class="text-2xl font-bold text-white">85%</p></div>
                <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-blue-400 text-center"><h3 class="text-gray-400 text-xs">Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h3><p class="text-2xl font-bold text-white">12.5K</p></div>
                <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-green-400 text-center"><h3 class="text-gray-400 text-xs">Ø§Ù„Ù…Ø­Ø±Ø±ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3><p class="text-2xl font-bold text-white">12</p></div>
            </div>
            <div class="bg-navy-800 p-4 rounded-xl border border-white/5 h-64 flex items-center justify-center">
                <canvas id="predictiveChart"></canvas>
            </div>
        </section>

        <!-- 5. ADMIN VIEW (Internal) -->
        <section id="view-admin" class="view-section hidden">
            <div id="login-gate" class="max-w-md mx-auto mt-10 bg-navy-800 p-8 rounded-2xl border border-white/10 text-center">
                <h2 class="text-2xl font-bold text-white mb-6">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h2>
                <form onsubmit="handleRealLogin(event)" class="space-y-4">
                    <input type="email" id="login-email" class="w-full bg-black/50 p-3 rounded text-white" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
                    <input type="password" id="login-password" class="w-full bg-black/50 p-3 rounded text-white" placeholder="Ø§Ù„Ø±Ù…Ø²">
                    <button class="w-full bg-gold-400 text-black font-bold py-3 rounded hover:bg-white">Ø¯Ø®ÙˆÙ„</button>
                </form>
            </div>
            <div id="admin-panel" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-white">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                    <button onclick="logout()" class="text-red-400 text-sm">Ø®Ø±ÙˆØ¬</button>
                </div>
                <!-- Editor -->
                <div class="bg-navy-800 p-6 rounded-2xl border border-white/10">
                    <input type="text" id="news-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±..." class="w-full bg-transparent text-2xl font-bold text-white mb-4 border-b border-white/10 pb-2 outline-none">
                    <textarea id="editor" class="w-full h-40 bg-black/30 rounded-lg p-3 text-white mb-4" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰..."></textarea>
                    <div class="flex gap-2">
                        <button onclick="triggerAI('title')" class="text-xs bg-white/10 text-gold-400 px-3 py-1 rounded">âœ¨ AI Ø¹Ù†Ø§ÙˆÙŠÙ†</button>
                        <button onclick="publishAction()" class="bg-gold-400 text-black px-6 py-2 rounded font-bold text-sm mr-auto">Ù†Ø´Ø±</button>
                    </div>
                    <div id="ai-output" class="hidden mt-4 p-3 bg-white/5 rounded text-xs text-gray-300"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modals & Toasts -->
    <div id="article-modal" class="fixed inset-0 z-[80] bg-black/95 hidden overflow-y-auto animate-fade-in">
        <div class="min-h-screen p-4 md:p-8">
            <button onclick="closeArticleModal()" class="fixed top-4 left-4 z-50 bg-white/10 text-white p-2 rounded-full hover:bg-red-500 transition"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="max-w-3xl mx-auto bg-navy-900 rounded-2xl overflow-hidden border border-white/10 shadow-2xl">
                <img id="modal-img" src="" class="w-full h-64 object-cover">
                <div class="p-6 md:p-10">
                    <span id="modal-cat" class="text-gold-400 text-xs font-bold uppercase"></span>
                    <h1 id="modal-title" class="text-2xl md:text-4xl font-bold text-white mt-2 mb-6 leading-tight"></h1>
                    <div class="prose prose-invert max-w-none text-gray-300 leading-loose" id="modal-body"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-6 left-6 bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-all z-[100] font-bold flex items-center gap-2">
        <i data-lucide="check-circle" class="w-5 h-5"></i> <span id="toast-msg">ØªÙ…</span>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-[90] bg-black/90 hidden items-center justify-center p-4">
        <div class="bg-navy-900 w-full max-w-sm rounded-2xl border border-white/10 p-6">
            <h3 class="text-lg font-bold text-white mb-4">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
            <p class="text-sm text-gray-400 mb-4">Ù„ØªÙØ¹ÙŠÙ„ Ù…ÙŠØ²Ø§Øª AIØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Gemini API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (ÙŠØªÙ… Ø­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙ‚Ø·).</p>
            <input type="password" id="api-key-input" placeholder="Paste Gemini API Key here" class="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white mb-4 focus:border-gold-400 outline-none">
            <div class="flex justify-end gap-3">
                <button onclick="document.getElementById('settings-modal').classList.add('hidden')" class="px-4 py-2 text-gray-400 hover:text-white">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="saveApiKey()" class="px-6 py-2 bg-gold-400 text-black font-bold rounded-lg hover:bg-gold-500">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            initCharts();
            initExplorer();
        });
        
        let apiKey = localStorage.getItem('gemini_api_key') || "";
        const sourceData = [
            { title: "ÙˆØ²ÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© ÙŠØ¨Ø­Ø« ØªØ·ÙˆÙŠØ± Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø®Ø±Ø¬", category: "Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©", date: "29 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 95 },
            { title: "Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø±Ø§ÙØ¯ Ø§Ù„Ø­Ø±Ù…ÙŠÙ† Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø¬", category: "Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©", date: "29 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 88 },
            { title: "ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ø§Ø¬Ù„Ø© Ù„Ø·Ø§Ø¦Ø±Ø§Øª A320", category: "Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©", date: "29 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 92 },
            { title: "Ø§Ù„Ø§ØªØ­Ø§Ø¯ ÙˆØ§Ù„Ø´Ø¨Ø§Ø¨.. Ù…ÙˆØ§Ø¬Ù‡Ø© Ø«Ø§Ù„Ø«Ø©", category: "Ø±ÙŠØ§Ø¶Ø©", date: "29 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 90 },
            { title: "Ø§Ù„Ø£Ù‡Ù„ÙŠ ÙŠØ¨Ù„Øº Ù†ØµÙ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (ÙƒØ£Ø³ Ø§Ù„Ù…Ù„Ùƒ)", category: "Ø±ÙŠØ§Ø¶Ø©", date: "29 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 85 },
            { title: "Ø¹ÙˆØ¯Ø© ÙØ¹Ø§Ù„ÙŠØ© â€œØ¨Ø³Ø·Ø© Ø§Ù„Ø±ÙŠØ§Ø¶â€", category: "Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©", date: "28 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 70 },
            { title: "ØºØ±ÙØ© Ø¬Ø§Ø²Ø§Ù† ÙˆØªÙ…ÙƒÙŠÙ† Ù…Ø³ØªÙÙŠØ¯ÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚", category: "Ø§Ù‚ØªØµØ§Ø¯", date: "28 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 65 },
            { title: "Ù…Ø¹Ø±Ø¶ Ù‚ØµØµ Ø¨Ù„Ø§ Ø£Ù„ÙˆØ§Ù† Ø¨Ø£Ø¨Ù‡Ø§", category: "Ø«Ù‚Ø§ÙØ©", date: "28 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 60 },
            { title: "ØªØ±Ø§Ø¬Ø¹ Ø¥Ø´ØºØ§Ù„ Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ Ø¨Ø§Ù„Ù…Ù…Ù„ÙƒØ©", category: "Ø³ÙŠØ§Ø­Ø©", date: "30 Ø£ÙƒØªÙˆØ¨Ø±", impact: 75 },
            { title: "ØµØ­Ø© Ù…ÙƒØ© ÙˆØ­Ù‚ÙˆÙ‚ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", category: "ØµØ­Ø©", date: "04 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 55 },
            { title: "Ø§Ù„Ø®Ù„ÙˆØ¯ ÙŠØ¹Ø¨Ø± Ø£Ù…ÙˆØ§Ø¬ Ø§Ù„Ø®Ù„ÙŠØ¬", category: "Ø±ÙŠØ§Ø¶Ø©", date: "28 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 80 },
            { title: "ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø¨Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©", category: "Ø®Ø¯Ù…Ø§Øª", date: "28 Ù†ÙˆÙÙ…Ø¨Ø±", impact: 72 }
        ];

        function initApp() {
            initKPIs();
            lucide.createIcons();
        }

        function switchView(viewId, btnElement) {
            ['view-overview', 'view-analytics', 'view-explorer', 'view-insights'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(`view-${viewId}`).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active-tab');
            });
            btnElement.classList.add('active-tab');
        }

        function initKPIs() {
            document.getElementById('kpi-total').innerText = sourceData.length;
            const counts = {};
            sourceData.forEach(d => counts[d.category] = (counts[d.category] || 0) + 1);
            const topCat = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            document.getElementById('kpi-top-cat').innerText = topCat;
        }

        function initCharts() {
            const counts = {};
            sourceData.forEach(d => counts[d.category] = (counts[d.category] || 0) + 1);
            const ctxDist = document.getElementById('distChart').getContext('2d');
            new Chart(ctxDist, {
                type: 'doughnut',
                data: { labels: Object.keys(counts), datasets: [{ data: Object.values(counts), backgroundColor: ['#0f172a', '#D4AF37', '#3b82f6', '#10b981', '#f59e0b', '#6366f1'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { font: { family: 'Tajawal' } } } } }
            });

            const sortedImpact = [...sourceData].sort((a,b) => b.impact - a.impact).slice(0, 5);
            const ctxImp = document.getElementById('impactChart').getContext('2d');
            new Chart(ctxImp, {
                type: 'bar',
                data: { labels: sortedImpact.map(i => i.title.substring(0, 15) + '...'), datasets: [{ label: 'Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ù‡Ù…ÙŠØ©', data: sortedImpact.map(i => i.impact), backgroundColor: '#D4AF37', borderRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, max: 100 }, y: { grid: { display: false } } }, plugins: { legend: { display: false } } }
            });
        }

        function initExplorer() {
            const filters = document.getElementById('filters-container');
            const categories = [...new Set(sourceData.map(d => d.category))];
            
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = "filter-btn px-4 py-2 rounded-full border border-gray-300 text-gray-600 bg-white font-medium text-sm hover:border-[#0f172a] hover:text-[#0f172a]";
                btn.innerText = cat;
                btn.onclick = () => filterContent(cat, btn);
                filters.appendChild(btn);
            });

            renderGrid(sourceData);
        }

        function filterContent(category, btn) {
            const allBtns = document.getElementById('filters-container').children;
            for(let b of allBtns) {
                b.className = "filter-btn px-4 py-2 rounded-full border border-gray-300 text-gray-600 bg-white font-medium text-sm hover:border-[#0f172a] hover:text-[#0f172a]";
            }
            btn.classList.remove('bg-white', 'text-gray-600');
            btn.className = "filter-btn active-filter px-4 py-2 rounded-full bg-[#0f172a] text-white font-bold text-sm shadow-lg border border-[#0f172a]";

            const filtered = category === 'all' ? sourceData : sourceData.filter(d => d.category === category);
            renderGrid(filtered);
        }

        function renderGrid(data) {
            const container = document.getElementById('content-grid');
            container.innerHTML = '';
            
            data.forEach(item => {
                const card = document.createElement('div');
                card.className = "glass-card p-5 rounded-xl border border-gray-100 flex flex-col justify-between h-40";
                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-bold text-[#D4AF37] bg-[#D4AF37]/10 px-2 py-1 rounded">${item.category}</span>
                            <span class="text-xs text-gray-400 font-mono">${item.date}</span>
                        </div>
                        <h3 class="font-bold text-[#0f172a] text-sm leading-snug line-clamp-2">${item.title}</h3>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5 mt-2 overflow-hidden">
                        <div class="bg-[#0f172a] h-1.5 rounded-full transition-all duration-1000" style="width: ${item.impact}%"></div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // --- AI LOGIC ---

        function checkAPIKey() {
            if (!apiKey) {
                document.getElementById('api-key-modal').classList.remove('hidden');
                return false;
            }
            return true;
        }

        function saveApiKey() {
            const key = document.getElementById('api-key-input').value;
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                apiKey = key;
                document.getElementById('api-key-modal').classList.add('hidden');
                alert("ØªÙ… Ø­ÙØ¸ Ù…ÙØªØ§Ø­ API!");
            }
        }

        async function callGemini(prompt, system) {
            if (!checkAPIKey()) return null;
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: system }] } })
                });

                const data = await response.json();
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                }
                return "ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„: Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙØ§Ø±ØºØ©.";
            } catch (error) {
                console.error("Gemini Error:", error);
                return "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.";
            }
        }

        async function analyzeTrends() {
            if (!checkAPIKey()) return;
            const btn = document.getElementById('btn-analyze-trends');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="loader"></div> Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ¬Ù‡Ø§Øª...';
            btn.disabled = true;

            const contentSummary = sourceData.map(d => `${d.category}: ${d.title} (Impact: ${d.impact})`).join('; ');
            const prompt = `
                Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ØµØ­ÙŠÙØ© 'Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©'. Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ²ÙŠØ¹ ÙˆÙ†Ù‚Ø§Ø· Ø§Ù„ØªØ£Ø«ÙŠØ±ØŒ Ø§Ø³ØªÙ†ØªØ¬ Ù…Ø§ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¹Ù„ÙŠÙ‡ Ø§Ù„ØªÙˆØ¬Ù‡Ø§Øª Ø§Ù„ØªØ­Ø±ÙŠØ±ÙŠØ© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù….
                Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${contentSummary}

                Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ØªÙ‚Ø±ÙŠØ± Ù…ÙˆØ¬Ø² (Markdown) ÙŠØ´Ù…Ù„:
                1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù‡ÙŠÙ…Ù†Ø©).
                2. 3 Ù…ÙˆØ§Ø¶ÙŠØ¹ Ù…Ù‚ØªØ±Ø­Ø© (Topics) ÙŠØ¬Ø¨ Ø²ÙŠØ§Ø¯ØªÙ‡Ø§.
                3. Ø§Ù‚ØªØ±Ø§Ø­ Ø¥Ø¬Ø±Ø§Ø¦ÙŠ ÙˆØ§Ø­Ø¯ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙØ§Ø¹Ù„.
            `;
            const analysis = await callGemini(prompt, "Ø£Ù†Øª Ù…Ø­Ù„Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø®Ø¨Ø§Ø±ÙŠ Ø®Ø¨ÙŠØ±.");

            document.getElementById('trends-content').innerHTML = analysis ? marked.parse(analysis) : "ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
            document.getElementById('trends-output').classList.remove('hidden');
            
            btn.innerHTML = originalHTML;
            btn.disabled = false;
        }

        async function generateStrategy() {
            if (!checkAPIKey()) return;
            const btn = document.getElementById('btn-generate-strategy');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="loader"></div> Ø¬Ø§Ø±ÙŠ ØµÙŠØ§ØºØ© Ø§Ù„Ø®Ø·Ø©...';
            btn.disabled = true;

            const strengths = "ØªØºØ·ÙŠØ© ÙÙˆØ±ÙŠØ© Ù„Ù„Ø±ÙŠØ§Ø¶Ø©ØŒ Ø§Ù‡ØªÙ…Ø§Ù… Ø¨Ø§Ù„Ø«Ù‚Ø§ÙØ©ØŒ ØªÙ†ÙˆØ¹ Ø¬ØºØ±Ø§ÙÙŠ.";
            const weaknesses = "Ù†Ù‚Øµ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ù†ÙŠØ©ØŒ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„ÙƒØªØ§Ø¨ Ø±Ø£ÙŠ Ø¬Ø¯Ø¯ØŒ Ø¶Ø¹Ù Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©.";
            
            const prompt = `
                Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØŒ Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¹Ù…Ù„ ØªÙ†ÙÙŠØ°ÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© (Roadmap) ÙÙŠ 5 Ù†Ù‚Ø§Ø· (Markdown). ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø®Ø·Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ° ÙˆØªØµØ­Ø­ Ø§Ù„Ø¶Ø¹Ù.

                - Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©: ${strengths}
                - Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù: ${weaknesses}

                Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ØªØªØ¶Ù…Ù† Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ØŒ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ØŒ ÙˆØ§Ù„Ù…ÙˆØ¹Ø¯.
            `;
            const strategy = await callGemini(prompt, "Ø£Ù†Øª Ù…Ø¯ÙŠØ± Ù…Ø´Ø±ÙˆØ¹ Ø®Ø¨ÙŠØ±.");

            document.getElementById('strategy-content').innerHTML = strategy ? marked.parse(strategy) : "ÙØ´Ù„ ØµÙŠØ§ØºØ© Ø§Ù„Ø®Ø·Ø©.";
            document.getElementById('strategy-output').classList.remove('hidden');

            btn.innerHTML = originalHTML;
            btn.disabled = false;
        }
    </script>
</body>
</html>


