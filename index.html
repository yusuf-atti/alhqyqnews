<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµØ­ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© | Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø£ÙˆÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Tajawal', 'sans-serif'],
                        serif: ['Amiri', 'serif']
                    },
                    colors: { 
                        navy: { 950: '#020205', 900: '#050510', 800: '#0a0a15' }, 
                        gold: { 400: '#D4AF37', 500: '#C5A028', 600: '#B49020' } 
                    },
                    animation: {
                        'ticker': 'ticker 30s linear infinite',
                        'fade-in': 'fadeIn 1s ease-out'
                    },
                    keyframes: {
                        ticker: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(-100%)' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020205; color: #e5e7eb; overflow-x: hidden; }
        .hero-gradient { background: linear-gradient(to top, #020205 0%, rgba(2,2,5,0.8) 50%, transparent 100%); }
        .glass-nav { background: rgba(5, 5, 16, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(212, 175, 55, 0.1); }
        .article-card:hover .card-overlay { opacity: 1; }
        ::-webkit-scrollbar { width: 8px; background: #0a0a15; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        /* Typography for Articles */
        .prose h1, .prose h2, .prose h3 { color: #fff; margin-top: 1.5em; margin-bottom: 0.5em; font-weight: bold; }
        .prose p { margin-bottom: 1em; line-height: 1.8; color: #d1d5db; font-family: 'Amiri', serif; font-size: 1.1rem; }
        .prose blockquote { border-right: 4px solid #D4AF37; padding-right: 1em; color: #D4AF37; font-style: italic; background: rgba(212,175,55,0.05); padding: 1em; margin: 1em 0; }
        .prose img { border-radius: 0.5rem; margin: 1.5em 0; width: 100%; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 glass-nav transition-all duration-300" id="navbar">
        <div class="container mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <h1 class="text-3xl font-black text-white tracking-tighter cursor-pointer" onclick="window.scrollTo(0,0)">
                    Ø§Ù„Ù€Ø­Ù‚ÙŠÙ‚Ø©<span class="text-gold-400 text-4xl">.</span>
                </h1>
                <span class="hidden md:block h-6 w-px bg-white/10 mx-2"></span>
                <div class="hidden md:flex gap-6 text-sm text-gray-400 font-medium">
                    <a href="#" class="hover:text-gold-400 transition-colors">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                    <a href="#" class="hover:text-gold-400 transition-colors">Ø³ÙŠØ§Ø³Ø©</a>
                    <a href="#" class="hover:text-gold-400 transition-colors">Ø§Ù‚ØªØµØ§Ø¯</a>
                    <a href="#" class="hover:text-gold-400 transition-colors">Ø¢Ø±Ø§Ø¡</a>
                </div>
            </div>
            <button class="bg-gold-400/10 text-gold-400 border border-gold-400/30 px-4 py-2 rounded-full text-xs font-bold hover:bg-gold-400 hover:text-black transition-all">
                Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ù†Ø´Ø±Ø©
            </button>
        </div>
        
        <!-- Breaking News Ticker -->
        <div class="bg-gold-600 text-black text-xs font-bold py-1 overflow-hidden relative border-t border-b border-gold-500">
            <div class="whitespace-nowrap inline-block animate-ticker" id="ticker-content">
                Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ø±ÙƒØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª... | Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨ÙƒÙØ§Ø¡Ø© ØªØ§Ù…Ø©...
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 pt-28 pb-20">
        
        <!-- Hero Section (Latest Article) -->
        <header id="hero-section" class="container mx-auto px-6 mb-16 min-h-[60vh] flex items-center justify-center relative rounded-3xl overflow-hidden border border-white/5 animate-fade-in group cursor-pointer">
            <div class="absolute inset-0 bg-navy-900 animate-pulse-slow z-0"></div> <!-- Placeholder -->
            <div class="z-10 text-center">
                <div class="w-12 h-12 border-4 border-gold-400 border-t-transparent rounded-full animate-spin mx-auto"></div>
                <p class="text-gray-500 mt-4 text-sm tracking-widest">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø©...</p>
            </div>
        </header>

        <!-- Articles Grid -->
        <section class="container mx-auto px-6">
            <div class="flex items-center gap-4 mb-8">
                <h2 class="text-2xl font-bold text-white border-r-4 border-gold-400 pr-4">Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</h2>
                <div class="h-px bg-white/10 flex-1"></div>
            </div>

            <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Skeleton Loader -->
                <div class="h-96 bg-white/5 rounded-2xl animate-pulse"></div>
                <div class="h-96 bg-white/5 rounded-2xl animate-pulse delay-75"></div>
                <div class="h-96 bg-white/5 rounded-2xl animate-pulse delay-150"></div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="border-t border-white/5 bg-[#050510] py-12">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-2xl font-black text-white mb-4">Ø§Ù„Ù€Ø­Ù‚ÙŠÙ‚Ø©<span class="text-gold-400">.</span></h2>
            <p class="text-gray-500 text-sm max-w-md mx-auto mb-8">Ù†Ø­Ù† Ù„Ø§ Ù†Ù†Ù‚Ù„ Ø§Ù„Ø®Ø¨Ø±ØŒ Ù†Ø­Ù† Ù†ØµÙ†Ø¹ Ø§Ù„ÙˆØ§Ù‚Ø¹. Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ«Ù‚Ø© ÙˆØ§Ù„Ø¯Ù‚ÙŠÙ‚Ø©.</p>
            <div class="text-gray-600 text-xs">
                &copy; 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠØ©.
            </div>
        </div>
    </footer>

    <!-- Article Reader Modal -->
    <div id="reader-modal" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-md hidden opacity-0 transition-opacity duration-300">
        <div class="absolute top-0 w-full h-1 bg-gradient-to-r from-transparent via-gold-400 to-transparent"></div>
        
        <!-- Close Button -->
        <button onclick="closeArticle()" class="fixed top-6 left-6 z-50 bg-white/10 hover:bg-white/20 text-white p-3 rounded-full backdrop-blur transition-all">
            <i data-lucide="x" class="w-6 h-6"></i>
        </button>

        <!-- Modal Content -->
        <div class="w-full h-full overflow-y-auto">
            <div class="max-w-4xl mx-auto bg-[#0a0a15] min-h-full shadow-2xl relative">
                <!-- Cover Image -->
                <div class="h-[60vh] w-full relative">
                    <img id="modal-img" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a15] via-[#0a0a15]/50 to-transparent"></div>
                    <div class="absolute bottom-0 right-0 p-8 md:p-12 w-full">
                        <span id="modal-category" class="bg-gold-400 text-black text-xs font-bold px-3 py-1 rounded mb-4 inline-block"></span>
                        <h1 id="modal-title" class="text-3xl md:text-5xl font-bold text-white leading-tight mb-4 font-serif"></h1>
                        <div class="flex items-center gap-4 text-sm text-gray-400">
                            <div class="flex items-center gap-2">
                                <i data-lucide="user" class="w-4 h-4"></i>
                                <span id="modal-author"></span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="clock" class="w-4 h-4"></i>
                                <span id="modal-date"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Body -->
                <div class="p-8 md:p-12">
                    <div id="modal-body" class="prose prose-invert prose-lg max-w-none text-gray-300"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, onSnapshot, query, orderBy, limit } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // 1. Init
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // 2. Auth: Use Custom Token if available (Critical for Permissions), else Anonymous
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) {
                console.error("Auth Error:", err);
            }
        };

        initAuth();

        // 3. Live Data Listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                const newsRef = collection(db, 'artifacts', appId, 'public', 'data', 'news');
                // We use simple query then client-side sort to avoid index errors in simple mode
                const q = query(newsRef); 

                onSnapshot(q, (snapshot) => {
                    const articles = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                    
                    // Sort: Newest first
                    articles.sort((a, b) => {
                        const ta = a.timestamp?.seconds || 0;
                        const tb = b.timestamp?.seconds || 0;
                        return tb - ta;
                    });

                    renderApp(articles);
                }, (error) => {
                    console.error("Error fetching news:", error);
                    // Handle Permission Denied gracefully in UI if needed
                    if (error.code === 'permission-denied') {
                        document.getElementById('ticker-content').innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ØµÙ„Ø§Ø­ÙŠØ§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ©.";
                    }
                });
            }
        });

        // 4. Render Logic
        function renderApp(articles) {
            const heroSection = document.getElementById('hero-section');
            const grid = document.getElementById('articles-grid');
            const ticker = document.getElementById('ticker-content');

            if (articles.length === 0) {
                heroSection.innerHTML = `<div class="text-center text-gray-500 z-10"><h2 class="text-3xl font-bold mb-2">Ù‚Ø±ÙŠØ¨Ø§Ù‹</h2><p>Ù„Ù… ÙŠØªÙ… Ù†Ø´Ø± Ø£ÙŠ Ø£Ø®Ø¨Ø§Ø± Ø¨Ø¹Ø¯.</p></div>`;
                grid.innerHTML = "";
                return;
            }

            // A. Update Ticker
            const titles = articles.slice(0, 5).map(a => `<span class="mx-8 text-black/80">ğŸ”´ ${a.title}</span>`).join('');
            ticker.innerHTML = titles + titles; // Duplicate for smooth scroll loop

            // B. Hero Section (First Article)
            const hero = articles[0];
            heroSection.onclick = () => openArticle(hero);
            heroSection.innerHTML = `
                <img src="${hero.img}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" onerror="this.src='https://via.placeholder.com/1200x600'">
                <div class="absolute inset-0 hero-gradient"></div>
                <div class="relative z-10 container mx-auto px-6 h-full flex flex-col justify-end pb-12 items-start text-right">
                    <span class="bg-gold-400 text-black px-3 py-1 rounded text-xs font-bold mb-4 animate-fade-in">Ø®Ø¨Ø± Ø±Ø¦ÙŠØ³ÙŠ</span>
                    <h2 class="text-4xl md:text-6xl font-black text-white leading-tight mb-4 max-w-4xl drop-shadow-lg">${hero.title}</h2>
                    <p class="text-gray-300 line-clamp-2 max-w-2xl mb-6 text-lg font-serif">${hero.desc.substring(0, 150)}...</p>
                    <div class="flex items-center gap-4 text-sm font-medium text-gray-400">
                        <span class="text-gold-400">${hero.author}</span>
                        <span>â€¢</span>
                        <span>${hero.date}</span>
                    </div>
                </div>
            `;

            // C. Grid (Rest of articles)
            const rest = articles.slice(1);
            grid.innerHTML = rest.map(art => `
                <article class="article-card group bg-[#0a0a15] rounded-2xl overflow-hidden border border-white/5 hover:border-gold-400/30 transition-all cursor-pointer flex flex-col h-full" onclick='window.currentArticles = ${JSON.stringify(articles)}; window.openArticleById("${art.id}")'>
                    <div class="relative h-48 overflow-hidden">
                        <img src="${art.img}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" onerror="this.src='https://via.placeholder.com/400'">
                        <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors"></div>
                        <span class="absolute top-4 right-4 bg-black/60 backdrop-blur text-white text-xs px-2 py-1 rounded border border-white/10">${art.category}</span>
                    </div>
                    <div class="p-6 flex-1 flex flex-col">
                        <h3 class="text-xl font-bold text-white mb-3 leading-snug group-hover:text-gold-400 transition-colors line-clamp-2">${art.title}</h3>
                        <p class="text-gray-500 text-sm line-clamp-3 mb-4 flex-1 font-serif">${art.desc.replace(/[*#]/g, '')}</p>
                        <div class="flex justify-between items-center text-xs text-gray-600 border-t border-white/5 pt-4 mt-auto">
                            <span>${art.date}</span>
                            <span class="group-hover:translate-x-[-5px] transition-transform text-gold-400 font-bold">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯ &larr;</span>
                        </div>
                    </div>
                </article>
            `).join('');
            
            // Expose for onClick mapping (crude but works for generated HTML strings)
            window.currentArticles = articles;
        }

        // 5. Modal Logic (Attached to Window)
        window.openArticleById = (id) => {
            const art = window.currentArticles.find(a => a.id === id);
            if(art) openArticle(art);
        };

        window.openArticle = (art) => {
            const modal = document.getElementById('reader-modal');
            document.getElementById('modal-img').src = art.img;
            document.getElementById('modal-category').innerText = art.category;
            document.getElementById('modal-title').innerText = art.title;
            document.getElementById('modal-author').innerText = art.author;
            document.getElementById('modal-date').innerText = art.date;
            
            // Parse Markdown for body
            document.getElementById('modal-body').innerHTML = marked.parse(art.desc);
            
            modal.classList.remove('hidden');
            // Slight delay for fade in
            requestAnimationFrame(() => {
                modal.classList.remove('opacity-0');
            });
            document.body.style.overflow = 'hidden';
        };

        window.closeArticle = () => {
            const modal = document.getElementById('reader-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }, 300);
        };

        if (window.lucide) lucide.createIcons();
    </script>
</body>
</html>
