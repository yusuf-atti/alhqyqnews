<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام الحقيقة المركزي | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    colors: { navy: { 950: '#020205', 900: '#050510', 800: '#0a0a15', 700: '#151525' }, gold: { 400: '#D4AF37', 500: '#C5A028' } },
                    animation: { 'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020205; color: #e5e7eb; overflow: hidden; }
        .glass-panel { background: rgba(21, 21, 37, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .sidebar-link { transition: all 0.3s; border-right: 3px solid transparent; }
        .sidebar-link:hover, .sidebar-link.active { background: rgba(212, 175, 55, 0.1); color: #D4AF37; border-right-color: #D4AF37; }
        .editor-content:empty:before { content: attr(placeholder); color: #4b5563; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0a0a15; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #D4AF37; }
        
        /* Table Styles */
        .table-row-hover:hover td { background-color: rgba(255, 255, 255, 0.03); }
    </style>
</head>
<body class="flex h-screen selection:bg-gold-400 selection:text-black">

    <!-- شاشة الدخول (Login Gate) -->
    <div id="login-gate" class="fixed inset-0 z-50 bg-[#020205] flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <div class="absolute inset-0 bg-gradient-to-t from-[#020205] via-transparent to-transparent"></div>
        <div class="glass-panel p-10 rounded-3xl w-full max-w-md relative z-10 border-t border-white/10 shadow-2xl">
            <div class="text-center mb-10">
                <h1 class="text-5xl font-black text-white tracking-tighter mb-2">الـحقيقة<span class="text-gold-400">.</span></h1>
                <p class="text-gray-500 text-xs tracking-[0.3em] uppercase">نظام إدارة المحتوى الذكي</p>
            </div>
            <form onsubmit="enterDashboard(event)" class="space-y-6">
                <div class="relative group">
                    <i data-lucide="user" class="absolute right-4 top-3.5 text-gray-500 group-focus-within:text-gold-400 transition-colors w-5 h-5"></i>
                    <input type="text" placeholder="معرف القائد" class="w-full bg-[#0a0a15] border border-white/10 rounded-xl py-3 pr-12 pl-4 text-white focus:outline-none focus:border-gold-400 transition-all placeholder-gray-600">
                </div>
                <div class="relative group">
                    <i data-lucide="lock" class="absolute right-4 top-3.5 text-gray-500 group-focus-within:text-gold-400 transition-colors w-5 h-5"></i>
                    <input type="password" placeholder="شفرة الدخول" class="w-full bg-[#0a0a15] border border-white/10 rounded-xl py-3 pr-12 pl-4 text-white focus:outline-none focus:border-gold-400 transition-all placeholder-gray-600">
                </div>
                <button class="w-full bg-gradient-to-r from-gold-400 to-yellow-600 text-black font-bold py-4 rounded-xl hover:shadow-[0_0_20px_rgba(212,175,55,0.3)] transition-all transform hover:-translate-y-1">
                    فتح النظام
                </button>
            </form>
            <div class="mt-8 text-center">
                <span class="text-[10px] text-gray-600">Powered by Gemini AI Engine v2.0</span>
            </div>
        </div>
    </div>

    <!-- النظام الداخلي (Dashboard System) -->
    <div id="system-ui" class="hidden w-full h-full flex opacity-0 transition-opacity duration-1000">
        
        <!-- الشريط الجانبي (Sidebar) -->
        <aside class="w-72 bg-[#050510] border-l border-white/5 flex flex-col relative z-20">
            <div class="h-24 flex items-center px-8 border-b border-white/5">
                <h2 class="text-2xl font-black text-white">الـحقيقة <span class="text-gold-400">Hub</span></h2>
            </div>

            <div class="flex-1 overflow-y-auto py-6 space-y-2 px-4">
                <p class="text-xs text-gray-600 font-bold px-4 mb-2 uppercase tracking-wider">التحكم</p>
                <button onclick="switchView('overview', this)" class="sidebar-link active w-full flex items-center gap-4 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i> نظرة عامة
                </button>
                <button onclick="switchView('editor', this)" class="sidebar-link w-full flex items-center gap-4 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium">
                    <i data-lucide="pen-tool" class="w-5 h-5"></i> المحرر الذكي
                </button>
                <button onclick="switchView('articles', this)" class="sidebar-link w-full flex items-center gap-4 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium">
                    <i data-lucide="file-text" class="w-5 h-5"></i> أرشيف المقالات
                </button>
                
                <p class="text-xs text-gray-600 font-bold px-4 mb-2 mt-6 uppercase tracking-wider">الإدارة</p>
                <button onclick="switchView('users', this)" class="sidebar-link w-full flex items-center gap-4 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium">
                    <i data-lucide="users" class="w-5 h-5"></i> فريق العمل
                </button>
                <button onclick="switchView('settings', this)" class="sidebar-link w-full flex items-center gap-4 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium">
                    <i data-lucide="settings" class="w-5 h-5"></i> إعدادات النظام
                </button>
            </div>

            <div class="p-6 border-t border-white/5">
                <div class="flex items-center gap-3">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Yousef" class="w-10 h-10 rounded-full bg-gray-800 border-2 border-gold-400">
                    <div>
                        <p class="text-white text-sm font-bold">يوسف عطية</p>
                        <p class="text-green-500 text-xs">متصل • رئيس التحرير</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- منطقة العمل (Workspace) -->
        <main class="flex-1 bg-[#020205] relative overflow-hidden flex flex-col">
            
            <!-- الرأس العلوي (Top Bar) -->
            <header class="h-24 flex items-center justify-between px-10 border-b border-white/5 bg-[#020205]/80 backdrop-blur z-10">
                <div>
                    <h1 id="page-title" class="text-2xl font-bold text-white">غرفة القيادة</h1>
                    <p id="page-desc" class="text-gray-500 text-sm">نظرة شاملة على أداء الصحيفة اليوم</p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="bg-navy-800 px-4 py-2 rounded-full border border-white/10 text-sm text-gray-300 flex items-center gap-2">
                        <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                        زوار الآن: <span class="text-white font-bold">1,204</span>
                    </div>
                    <button class="p-2 text-gray-400 hover:text-white relative" onclick="showNotification('لا توجد إشعارات جديدة')">
                        <i data-lucide="bell" class="w-6 h-6"></i>
                        <span class="absolute top-2 right-2 w-2 h-2 bg-gold-400 rounded-full"></span>
                    </button>
                </div>
            </header>

            <!-- المحتوى المتغير (Dynamic Content) -->
            <div class="flex-1 overflow-y-auto p-10 scroll-smooth relative">
                
                <!-- VIEW 1: OVERVIEW -->
                <div id="view-overview" class="view-section space-y-8 animate-fade-in">
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="glass-panel p-6 rounded-2xl border-t-4 border-gold-400">
                            <div class="text-gray-400 text-xs uppercase tracking-widest mb-2">إجمالي المشاهدات</div>
                            <div class="text-4xl font-bold text-white mb-1">245.8K</div>
                            <div class="text-green-500 text-sm flex items-center gap-1"><i data-lucide="trending-up" class="w-3 h-3"></i> +12% هذا الأسبوع</div>
                        </div>
                        <div class="glass-panel p-6 rounded-2xl border-t-4 border-blue-500">
                            <div class="text-gray-400 text-xs uppercase tracking-widest mb-2">مقالات منشورة</div>
                            <div class="text-4xl font-bold text-white mb-1">1,890</div>
                            <div class="text-gray-500 text-sm">الأرشيف الكامل</div>
                        </div>
                        <div class="glass-panel p-6 rounded-2xl border-t-4 border-purple-500">
                            <div class="text-gray-400 text-xs uppercase tracking-widest mb-2">تفاعل الذكاء الاصطناعي</div>
                            <div class="text-4xl font-bold text-white mb-1">85%</div>
                            <div class="text-purple-400 text-sm">معدل استخدام الأدوات</div>
                        </div>
                        <div class="glass-panel p-6 rounded-2xl border-t-4 border-green-500">
                            <div class="text-gray-400 text-xs uppercase tracking-widest mb-2">حالة السيرفر</div>
                            <div class="text-4xl font-bold text-white mb-1">99.9%</div>
                            <div class="text-green-500 text-sm">مستقر</div>
                        </div>
                    </div>

                    <!-- Main Chart -->
                    <div class="glass-panel p-8 rounded-2xl">
                        <h3 class="text-white font-bold mb-6 flex items-center gap-2"><i data-lucide="activity" class="text-gold-400"></i> تدفق الزوار (Live)</h3>
                        <canvas id="trafficChart" height="80"></canvas>
                    </div>
                </div>

                <!-- VIEW 2: SMART EDITOR (The Core) -->
                <div id="view-editor" class="view-section hidden space-y-6">
                    <div class="flex gap-6 h-full">
                        <!-- Writing Area -->
                        <div class="flex-1 space-y-6">
                            <input type="text" placeholder="عنوان الخبر الرئيسي..." class="w-full bg-transparent text-4xl font-black text-white placeholder-gray-700 border-none focus:ring-0 px-0">
                            
                            <!-- Editor Toolbar -->
                            <div class="flex items-center gap-2 bg-navy-800/50 p-2 rounded-lg w-fit border border-white/5">
                                <button class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded"><i data-lucide="bold" class="w-4 h-4"></i></button>
                                <button class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded"><i data-lucide="italic" class="w-4 h-4"></i></button>
                                <button class="p-2 text-gray-400 hover:text-white hover:bg-white/10 rounded"><i data-lucide="link" class="w-4 h-4"></i></button>
                                <div class="w-px h-4 bg-gray-700 mx-2"></div>
                                <button class="p-2 text-gold-400 hover:bg-gold-400/10 rounded flex items-center gap-2 text-sm" onclick="triggerAI('expand')">
                                    <i data-lucide="sparkles" class="w-4 h-4"></i> إكمال تلقائي
                                </button>
                            </div>

                            <div class="editor-content w-full h-[500px] text-lg text-gray-300 leading-loose outline-none" contenteditable="true" placeholder="ابدأ كتابة القصة هنا... دع إبداعك يتدفق."></div>
                        </div>

                        <!-- AI Sidebar -->
                        <div class="w-80 flex-shrink-0 space-y-6">
                            <div class="glass-panel p-5 rounded-xl">
                                <button onclick="publishAction()" class="w-full bg-gold-400 text-black font-bold py-3 rounded-lg hover:bg-white transition-colors flex justify-center items-center gap-2 shadow-lg shadow-gold-400/20">
                                    <span>نشر الآن</span>
                                    <i data-lucide="send" class="w-4 h-4"></i>
                                </button>
                            </div>

                            <div class="glass-panel p-5 rounded-xl border-t-2 border-purple-500">
                                <h4 class="text-white font-bold mb-4 flex items-center gap-2">
                                    <i data-lucide="brain-circuit" class="text-purple-500"></i> مساعد Gemini
                                </h4>
                                <div class="space-y-3">
                                    <button onclick="triggerAI('title')" class="w-full text-right p-3 rounded-lg bg-white/5 hover:bg-white/10 text-sm text-gray-300 transition-colors flex justify-between items-center group">
                                        <span>اقترح عناوين جذابة</span>
                                        <i data-lucide="chevron-left" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                    </button>
                                    <button onclick="triggerAI('summary')" class="w-full text-right p-3 rounded-lg bg-white/5 hover:bg-white/10 text-sm text-gray-300 transition-colors flex justify-between items-center group">
                                        <span>تلخيص للنشرة البريدية</span>
                                        <i data-lucide="chevron-left" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                    </button>
                                    <button onclick="triggerAI('seo')" class="w-full text-right p-3 rounded-lg bg-white/5 hover:bg-white/10 text-sm text-gray-300 transition-colors flex justify-between items-center group">
                                        <span>تحسين SEO</span>
                                        <i data-lucide="chevron-left" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                    </button>
                                </div>
                                <div id="ai-output" class="mt-4 p-3 bg-black/40 rounded-lg text-xs text-gray-400 hidden border border-white/5">
                                    جاري المعالجة...
                                </div>
                            </div>

                            <div class="glass-panel p-5 rounded-xl">
                                <label class="text-gray-500 text-xs font-bold block mb-2">الوسائط</label>
                                <div class="aspect-video bg-black/40 rounded-lg border-2 border-dashed border-gray-700 flex items-center justify-center cursor-pointer hover:border-gold-400 transition-colors text-gray-600 hover:text-gold-400">
                                    <div class="text-center">
                                        <i data-lucide="image-plus" class="w-8 h-8 mx-auto mb-1"></i>
                                        <span class="text-xs">رفع صورة</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW 3: ARTICLE ARCHIVE (NEW) -->
                <div id="view-articles" class="view-section hidden space-y-6 animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4 glass-panel p-4 rounded-xl">
                        <div class="flex gap-2">
                            <div class="relative">
                                <i data-lucide="search" class="absolute right-3 top-2.5 w-4 h-4 text-gray-500"></i>
                                <input type="text" placeholder="بحث في الأرشيف..." class="bg-navy-950 border border-white/10 rounded-lg py-2 pr-10 pl-4 text-sm text-white focus:border-gold-400 outline-none w-64">
                            </div>
                            <select class="bg-navy-950 border border-white/10 rounded-lg px-4 py-2 text-sm text-gray-300 focus:border-gold-400 outline-none">
                                <option>جميع الأقسام</option>
                                <option>أخبار محلية</option>
                                <option>اقتصاد</option>
                                <option>رياضة</option>
                            </select>
                        </div>
                        <button onclick="switchView('editor', document.querySelectorAll('.sidebar-link')[1])" class="bg-gold-400 text-black px-4 py-2 rounded-lg text-sm font-bold hover:bg-white transition flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i> مقال جديد
                        </button>
                    </div>

                    <div class="glass-panel rounded-xl overflow-hidden">
                        <table class="w-full text-right text-gray-300">
                            <thead class="bg-white/5 text-xs uppercase font-bold text-gray-400">
                                <tr>
                                    <th class="p-4">العنوان</th>
                                    <th class="p-4">القسم</th>
                                    <th class="p-4">الحالة</th>
                                    <th class="p-4">الكاتب</th>
                                    <th class="p-4">تاريخ النشر</th>
                                    <th class="p-4">تفاعل</th>
                                    <th class="p-4">إجراءات</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-white/5 text-sm" id="articles-list">
                                <!-- سيتم ملؤه بواسطة JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- VIEW 4: TEAM MANAGEMENT (NEW) -->
                <div id="view-users" class="view-section hidden space-y-6 animate-fade-in">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-white">فريق التحرير</h3>
                        <button class="border border-gold-400 text-gold-400 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gold-400 hover:text-black transition flex items-center gap-2">
                            <i data-lucide="user-plus" class="w-4 h-4"></i> دعوة عضو
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="users-grid">
                        <!-- سيتم ملؤه بواسطة JS -->
                    </div>
                </div>

                <!-- VIEW 5: SETTINGS -->
                <div id="view-settings" class="view-section hidden max-w-2xl mx-auto">
                    <div class="glass-panel p-8 rounded-2xl space-y-6">
                        <h3 class="text-2xl font-bold text-white border-b border-white/10 pb-4">إعدادات النظام</h3>
                        
                        <div>
                            <label class="text-gold-400 text-sm font-bold block mb-2">مفتاح الذكاء الاصطناعي (Gemini API)</label>
                            <div class="flex gap-2">
                                <input type="password" id="api-key-setting" class="flex-1 bg-navy-950 border border-white/10 rounded-lg px-4 py-3 text-white focus:border-gold-400 outline-none" placeholder="AIzaSy...">
                                <button onclick="saveSettings()" class="bg-white/10 text-white px-6 rounded-lg hover:bg-white/20">حفظ</button>
                            </div>
                            <p class="text-xs text-gray-600 mt-2">هذا المفتاح يستخدم لتشغيل ميزات التوليد والتحليل.</p>
                        </div>

                        <div class="pt-6">
                            <label class="text-white text-sm font-bold block mb-4">تخصيص الواجهة</label>
                            <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg mb-2">
                                <span class="text-gray-300">الوضع الليلي العميق</span>
                                <div class="w-10 h-5 bg-gold-400 rounded-full relative cursor-pointer"><div class="absolute right-1 top-1 w-3 h-3 bg-black rounded-full"></div></div>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                                <span class="text-gray-300">إشعارات صوتية</span>
                                <div class="w-10 h-5 bg-gray-700 rounded-full relative cursor-pointer"><div class="absolute left-1 top-1 w-3 h-3 bg-white rounded-full"></div></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-6 left-6 bg-navy-900 border border-gold-400/50 text-white px-6 py-4 rounded-xl shadow-2xl transform translate-y-24 opacity-0 transition-all duration-300 flex items-center gap-3 z-[100]">
        <i data-lucide="check-circle" class="text-gold-400"></i>
        <span id="toast-msg" class="font-bold">تمت العملية بنجاح</span>
    </div>

    <script>
        lucide.createIcons();

        // --- Gate Logic ---
        function enterDashboard(e) {
            e.preventDefault();
            const gate = document.getElementById('login-gate');
            const system = document.getElementById('system-ui');
            
            // Animation
            gate.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                gate.style.display = 'none';
                system.classList.remove('hidden');
                setTimeout(() => {
                    system.classList.remove('opacity-0');
                    initChart(); // Initialize charts
                    loadMockData(); // Load Archive & Users
                }, 50);
            }, 800);
        }

        // --- Navigation Logic ---
        function switchView(viewName, btn) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${viewName}`).classList.remove('hidden');

            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active', 'bg-white/5', 'text-white'));
            btn.classList.add('active');

            const titles = {
                'overview': 'غرفة القيادة',
                'editor': 'المحرر الذكي',
                'articles': 'أرشيف المقالات',
                'users': 'فريق العمل',
                'settings': 'الإعدادات'
            };
            document.getElementById('page-title').innerText = titles[viewName];
        }

        // --- Data Loading (Mock) ---
        function loadMockData() {
            // 1. Load Articles
            const articles = [
                { title: "وزير البيئة يبحث تطوير مشاريع الخرج", cat: "أخبار محلية", status: "منشور", author: "يوسف عطية", date: "29/11/2025", views: "12.5K" },
                { title: "تحديثات عاجلة لطائرات A320", cat: "اقتصاد", status: "مسودة", author: "سارة علي", date: "28/11/2025", views: "-" },
                { title: "الأهلي يبلغ نصف النهائي", cat: "رياضة", status: "منشور", author: "خالد عمر", date: "29/11/2025", views: "45.2K" },
                { title: "مستقبل الذكاء الاصطناعي في الإعلام", cat: "تقنية", status: "مجدول", author: "يوسف عطية", date: "30/11/2025", views: "-" },
            ];
            
            const articleTable = document.getElementById('articles-list');
            articleTable.innerHTML = articles.map(a => `
                <tr class="table-row-hover transition-colors border-b border-white/5 last:border-0">
                    <td class="p-4 font-bold text-white">${a.title}</td>
                    <td class="p-4"><span class="bg-white/5 px-2 py-1 rounded text-xs">${a.cat}</span></td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded text-xs font-bold ${a.status === 'منشور' ? 'bg-green-500/20 text-green-400' : (a.status === 'مسودة' ? 'bg-yellow-500/20 text-yellow-400' : 'bg-blue-500/20 text-blue-400')}">
                            ${a.status}
                        </span>
                    </td>
                    <td class="p-4 text-xs">${a.author}</td>
                    <td class="p-4 text-xs font-mono">${a.date}</td>
                    <td class="p-4 text-xs font-mono text-gold-400">${a.views}</td>
                    <td class="p-4 flex gap-2">
                        <button class="p-1 hover:text-white text-gray-400" title="تعديل"><i data-lucide="edit-2" class="w-4 h-4"></i></button>
                        <button class="p-1 hover:text-red-400 text-gray-400" title="حذف" onclick="deleteItem(this)"><i data-lucide="trash" class="w-4 h-4"></i></button>
                    </td>
                </tr>
            `).join('');

            // 2. Load Users
            const users = [
                { name: "يوسف عطية", role: "رئيس التحرير", status: "online", email: "editor@hqyq.com", seed: "Yousef" },
                { name: "سارة علي", role: "كاتب محتوى", status: "offline", email: "sara@hqyq.com", seed: "Sara" },
                { name: "خالد عمر", role: "مراسل رياضي", status: "online", email: "khaled@hqyq.com", seed: "Khaled" },
                { name: "نورة الأحمد", role: "مدير تقني", status: "busy", email: "tech@hqyq.com", seed: "Noura" },
            ];

            const userGrid = document.getElementById('users-grid');
            userGrid.innerHTML = users.map(u => `
                <div class="glass-panel p-6 rounded-xl flex flex-col items-center text-center relative group hover:border-gold-400/50 transition-colors">
                    <div class="absolute top-4 right-4">
                        <div class="w-3 h-3 rounded-full ${u.status === 'online' ? 'bg-green-500' : (u.status === 'busy' ? 'bg-red-500' : 'bg-gray-500')} border-2 border-[#020205]"></div>
                    </div>
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${u.seed}" class="w-20 h-20 rounded-full bg-gray-800 mb-4 border-2 border-white/10 group-hover:border-gold-400 transition-colors">
                    <h3 class="text-white font-bold text-lg">${u.name}</h3>
                    <p class="text-gold-400 text-sm mb-1">${u.role}</p>
                    <p class="text-gray-500 text-xs mb-4 font-mono">${u.email}</p>
                    <div class="flex gap-2 w-full">
                        <button class="flex-1 bg-white/5 py-2 rounded-lg text-xs hover:bg-white/10 transition">الملف</button>
                        <button class="flex-1 bg-white/5 py-2 rounded-lg text-xs hover:bg-white/10 transition">صلاحيات</button>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // --- Notification System ---
        function showNotification(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-24', 'opacity-0');
            }, 3000);
        }

        function deleteItem(btn) {
            if(confirm("هل أنت متأكد من الحذف؟")) {
                btn.closest('tr').remove();
                showNotification("تم حذف المقال بنجاح");
            }
        }

        // --- Chart Logic ---
        function initChart() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', '23:59'],
                    datasets: [{
                        label: 'الزوار',
                        data: [120, 200, 450, 1200, 1500, 900, 600],
                        borderColor: '#D4AF37',
                        backgroundColor: 'rgba(212, 175, 55, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666' } },
                        y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#666' } }
                    }
                }
            });
        }

        // --- Editor Logic ---
        function triggerAI(action) {
            const output = document.getElementById('ai-output');
            output.classList.remove('hidden');
            output.innerHTML = '<div class="flex items-center gap-2"><div class="w-3 h-3 border-2 border-gold-400 border-t-transparent rounded-full animate-spin"></div> جاري الاتصال بـ Gemini...</div>';
            
            setTimeout(() => {
                let response = "";
                if(action === 'title') response = "1. عاصفة التغيير: قراءة في المشهد الجديد<br>2. ما وراء الخبر: حقائق تكشف لأول مرة<br>3. الحقيقة الكاملة: ملف خاص";
                if(action === 'summary') response = "تم تلخيص المقال في 50 كلمة للنشره البريدية بنجاح.";
                
                output.innerHTML = `<div class="text-white">${response}</div>`;
                showNotification("تم توليد المحتوى الذكي");
            }, 2000);
        }

        function publishAction() {
            const btn = document.querySelector('button[onclick="publishAction()"]');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = 'جاري الرفع...';
            setTimeout(() => {
                btn.classList.replace('bg-gold-400', 'bg-green-500');
                btn.innerHTML = 'تم النشر بنجاح ✓';
                showNotification("تم نشر المقال على الموقع الحي");
                setTimeout(() => {
                    btn.classList.replace('bg-green-500', 'bg-gold-400');
                    btn.innerHTML = originalHTML;
                }, 3000);
            }, 1500);
        }

        function saveSettings() {
            const key = document.getElementById('api-key-setting').value;
            if(key) {
                localStorage.setItem('gemini_api_key', key);
                showNotification("تم حفظ الإعدادات وتفعيل المحرك");
            }
        }
    </script>
</body>
</html>
