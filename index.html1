<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ØµØ­ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#050510">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['IBM Plex Sans Arabic', 'sans-serif'] },
                    colors: {
                        navy: { 900: '#050510', 800: '#0f1219', 700: '#1a1d26' },
                        gold: { 400: '#D4AF37', 500: '#C5A028' }
                    },
                    animation: { 'marquee': 'marquee 30s linear infinite' },
                    keyframes: { marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } } }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050510; color: #f3f4f6; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .nav-item.active { border-bottom: 2px solid #D4AF37; color: #D4AF37; }
        .sidebar { transition: transform 0.3s ease-in-out; transform: translateX(100%); }
        .sidebar.open { transform: translateX(0); }
        .glass-header { background: rgba(5, 5, 16, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: #D4AF37; width: 24px; height: 24px; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .view-hidden { display: none !important; }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- HEADER & NAVIGATION (Sticky) -->
    <header class="fixed top-0 w-full z-50 glass-header">
        <div class="container mx-auto px-4 h-16 flex justify-between items-center">
            
            <!-- Logo -->
            <div class="flex items-center gap-3" onclick="window.location.reload()">
                <div class="text-2xl font-black text-white tracking-tighter">
                    Ø§Ù„Ù€Ø­Ù‚ÙŠÙ‚Ø©<span class="text-gold-400">.</span>
                </div>
            </div>

            <!-- Search & Menu -->
            <div class="flex items-center gap-4">
                <button class="text-gray-400 hover:text-white"><i data-lucide="search" class="w-5 h-5"></i></button>
                <button onclick="toggleSidebar()" class="text-white focus:outline-none"><i data-lucide="menu" class="w-7 h-7"></i></button>
            </div>
        </div>

        <!-- Public Menu (News Categories Only) -->
        <div class="w-full overflow-x-auto scrollbar-hide bg-navy-800 border-b border-white/5">
            <div class="flex px-4 min-w-max">
                <button onclick="switchPublicView('home', this)" class="nav-item active px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button onclick="switchPublicView('local', this)" class="nav-item px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ø£Ø®Ø¨Ø§Ø± Ù…Ø­Ù„ÙŠØ©</button>
                <button onclick="switchPublicView('articles', this)" class="nav-item px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">Ù…Ù‚Ø§Ù„Ø§Øª</button>
                <button onclick="switchPublicView('reports', this)" class="nav-item px-6 py-3 text-sm font-bold text-gray-300 whitespace-nowrap">ØªÙ‚Ø§Ø±ÙŠØ±</button>
            </div>
        </div>
    </header>

    <!-- SIDEBAR MENU -->
    <aside id="main-sidebar" class="sidebar fixed inset-y-0 right-0 w-72 bg-[#1a1d26] z-[60] shadow-2xl border-l border-white/10 overflow-y-auto">
        <div class="p-5 border-b border-white/10 flex justify-between items-center">
            <h2 class="text-lg font-bold text-white">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
            <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
        </div>
        <div class="p-4 space-y-2">
            <button onclick="switchPublicView('home'); toggleSidebar()" class="w-full flex items-center gap-2 py-3 text-gray-300 hover:text-gold-400 font-bold border-b border-white/5">
                <i data-lucide="home" class="w-4 h-4"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            <button onclick="toggleAdminView(); toggleSidebar()" class="w-full flex items-center gap-2 py-3 text-gold-400 hover:text-white font-bold mt-4 bg-white/5 rounded px-3">
                <i data-lucide="shield" class="w-4 h-4"></i> Ø¯Ø®ÙˆÙ„ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ØµØ­ÙŠÙØ© (Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
            </button>
        </div>
    </aside>
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-50 hidden backdrop-blur-sm"></div>

    <!-- PUBLIC CONTENT AREA -->
    <main id="public-content" class="pt-32 pb-20 container mx-auto px-4 min-h-screen">
        <!-- Ticker -->
        <div class="bg-navy-800 border border-white/5 rounded-lg p-2 mb-6 flex items-center gap-3 shadow-lg">
            <span class="bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded animate-pulse">Ø¹Ø§Ø¬Ù„</span>
            <div class="w-full overflow-hidden relative h-5">
                <div id="ticker-content" class="absolute whitespace-nowrap animate-marquee text-xs text-gray-300 pt-0.5">
                    Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ© | ØªØµÙ…ÙŠÙ… ÙˆØ¥Ø´Ø±Ø§Ù: ÙŠÙˆØ³Ù Ø§Ù„Ø¹ØªÙŠ ... Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...
                </div>
            </div>
        </div>

        <div id="hero-section" class="mb-8 relative h-[400px] rounded-2xl bg-white/5 animate-pulse flex items-center justify-center border border-white/5">
            <div class="loader"></div>
        </div>

        <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="h-64 bg-white/5 rounded-xl animate-pulse"></div>
            <div class="h-64 bg-white/5 rounded-xl animate-pulse"></div>
        </div>
    </main>

    <!-- ADMIN DASHBOARD (The Command Room) -->
    <div id="admin-view" class="view-hidden fixed inset-0 z-[70] bg-[#050510] w-full h-full overflow-y-auto">
        
        <!-- Login Gate -->
        <div id="login-gate" class="min-h-screen flex items-center justify-center p-4">
            <div class="glass-panel p-10 rounded-3xl w-full max-w-md text-center relative border border-gold-400/20 shadow-2xl bg-navy-800">
                <button onclick="toggleAdminView()" class="absolute top-4 right-4 text-gray-500 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
                <h1 class="text-3xl font-bold text-white mb-2">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h1>
                <form onsubmit="handleRealLogin(event)" class="space-y-6 mt-6">
                    <input type="email" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø±Ø³Ù…ÙŠ" class="w-full bg-[#0a0a15] border border-white/10 rounded-xl py-3 px-4 text-white focus:border-gold-400 outline-none">
                    <input type="password" id="login-password" placeholder="Ø§Ù„Ø´ÙØ±Ø©" class="w-full bg-[#0a0a15] border border-white/10 rounded-xl py-3 px-4 text-white focus:border-gold-400 outline-none">
                    <button class="w-full bg-gold-400 text-black font-bold py-4 rounded-xl hover:bg-white transition shadow-lg">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                </form>
            </div>
        </div>

        <!-- Admin UI -->
        <div id="dashboard-ui" class="hidden min-h-screen flex flex-col lg:flex-row">
            <!-- Admin Sidebar -->
            <aside class="w-full lg:w-72 bg-navy-900 border-l border-white/5 flex flex-col z-20">
                <div class="h-16 flex items-center justify-between px-6 border-b border-white/5">
                    <h2 class="text-xl font-bold text-white">ØºØ±ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
                    <button onclick="toggleAdminView()" class="lg:hidden text-gray-400"><i data-lucide="x"></i></button>
                </div>
                <div class="flex-1 p-4 space-y-1 overflow-y-auto">
                    
                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
                    <button onclick="switchDashView('editor', this)" class="sidebar-link active w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="pen-tool" class="w-4 h-4"></i> Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„Ø°ÙƒÙŠ</button>
                    <button onclick="switchDashView('articles', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="file-text" class="w-4 h-4"></i> Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
                    
                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2 mt-2">Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© (Ø¬Ø¯ÙŠØ¯)</p>
                    <button onclick="switchDashView('innovations', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="lightbulb" class="w-4 h-4 text-gold-400"></i> Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ø§Ù„Ù€ 15</button>
                    <button onclick="switchDashView('impact', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="bar-chart-2" class="w-4 h-4 text-blue-400"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø«Ø±</button>
                    
                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2 mt-2">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</p>
                    <button onclick="switchDashView('hr', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="users" class="w-4 h-4"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
                    <button onclick="switchDashView('contract', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="file-signature" class="w-4 h-4"></i> Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹Ù‚Ø¯</button>

                    <p class="text-[10px] text-gray-500 font-bold uppercase px-2 py-2 mt-2">Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    <button onclick="switchDashView('settings', this)" class="sidebar-link w-full flex items-center gap-3 px-4 py-3 text-gray-400 hover:bg-white/5 rounded-lg text-sm font-medium"><i data-lucide="settings" class="w-4 h-4"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…ÙØªØ§Ø­ AI)</button>
                </div>
                <div class="p-4 border-t border-white/5">
                    <button onclick="logout()" class="w-full flex items-center justify-center gap-2 text-red-400 hover:bg-red-400/10 text-xs py-2 rounded-lg transition"><i data-lucide="log-out" class="w-3 h-3"></i> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>
            </aside>

            <div class="flex-1 bg-[#020205] overflow-y-auto p-6">
                
                <!-- 1. Editor Tab -->
                <div id="sec-editor" class="view-section max-w-4xl mx-auto space-y-6">
                    <h2 class="text-2xl font-bold text-white">Ù†Ø´Ø± Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</h2>
                    <input type="text" id="news-title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†..." class="w-full bg-transparent text-3xl font-bold text-white border-none focus:ring-0 px-0">
                    <textarea id="editor" class="w-full h-64 bg-navy-800 border border-white/10 rounded-xl p-4 text-white" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰..."></textarea>
                    <button onclick="publishAction()" id="publish-btn" class="w-full bg-gold-400 text-black font-bold py-3 rounded-lg">Ù†Ø´Ø± ğŸš€</button>
                </div>

                <!-- 2. Innovations Tab (Moved inside) -->
                <div id="sec-innovations" class="view-section hidden space-y-6">
                    <h2 class="text-2xl font-bold text-white mb-4 border-r-4 border-gold-400 pr-3">Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª Ø§Ù„Ù€ 15</h2>
                    <div id="features-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- 3. Impact Dashboard Tab (Moved inside) -->
                <div id="sec-impact" class="view-section hidden space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-gold-400 text-center"><h3 class="text-gray-400 text-xs">Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ†Ø¨Ø¤</h3><p class="text-2xl font-bold text-white">85%</p></div>
                        <div class="bg-navy-800 p-4 rounded-xl border-t-4 border-blue-400 text-center"><h3 class="text-gray-400 text-xs">Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</h3><p class="text-2xl font-bold text-white">12.5K</p></div>
                    </div>
                    <div class="bg-navy-800 p-4 rounded-xl border border-white/5 h-64 flex items-center justify-center">
                        <canvas id="predictiveChart"></canvas>
                    </div>
                </div>

                <!-- 4. Contract Tab (Moved inside) -->
                <div id="sec-contract" class="view-section hidden max-w-2xl mx-auto">
                     <div class="bg-navy-800 p-6 rounded-xl border border-white/10">
                        <h3 class="text-white font-bold mb-4">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h3>
                        <p class="text-gray-400 text-sm mb-4">Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…ÙˆØ¸Ù Ø¹Ù†Ø¯ ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„ØªÙˆØ¸ÙŠÙ.</p>
                        <div class="bg-black/30 p-4 rounded text-xs text-gray-500 h-40 overflow-y-auto">
                            Ù†Øµ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ... Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰... Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©... (Ù†Ø³Ø®Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
                        </div>
                    </div>
                </div>
                
                <!-- 5. HR Tab -->
                <div id="sec-hr" class="view-section hidden max-w-4xl mx-auto">
                    <div class="flex justify-between items-center mb-6">
                         <h2 class="text-2xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ§Ø¯Ø±</h2>
                         <button onclick="generateInviteLink()" class="bg-gold-400 text-black px-4 py-2 rounded-lg font-bold text-sm">ØªÙˆÙ„ÙŠØ¯ Ø±Ø§Ø¨Ø· ØªÙˆØ¸ÙŠÙ</button>
                    </div>
                    <div id="invite-box" class="hidden bg-white/10 p-4 rounded-xl mb-6">
                        <p class="text-xs text-gold-400">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©:</p>
                        <input type="text" id="invite-link-val" readonly class="w-full bg-transparent text-white text-xs">
                    </div>
                </div>

                <!-- 6. Settings Tab -->
                <div id="sec-settings" class="view-section hidden max-w-md mx-auto">
                    <h3 class="text-white font-bold mb-4">Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                    <input type="password" id="api-key-setting" class="w-full bg-navy-800 border border-white/10 rounded p-3 text-white">
                    <button onclick="saveApiKey()" class="mt-4 w-full bg-gold-400 text-black font-bold py-2 rounded">Ø­ÙØ¸</button>
                </div>

                <!-- Archive Tab -->
                <div id="sec-articles" class="view-section hidden">
                    <div id="admin-articles-list" class="space-y-2"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 left-6 bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-all z-[100] font-bold">ØªÙ…</div>

    <script>
        function initIcons() { if (window.lucide) lucide.createIcons(); }
        document.addEventListener('DOMContentLoaded', () => { initIcons(); fetchNews(); renderFeatures(); });

        // Firebase Config
        const firebaseConfig = { apiKey: "AIzaSyD7b1PZY26GN6hR2pliqiFRgyMsNyRlWOs", authDomain: "alhqyqa-62b0e.firebaseapp.com", projectId: "alhqyqa-62b0e", storageBucket: "alhqyqa-62b0e.firebasestorage.app", messagingSenderId: "354014970954", appId: "1:354014970954:web:435ca4eb0cbbfcfd1152b3" };
        let isOfflineMode = false;
        const LOCAL_NEWS_KEY = "local_news_db";
        let db, auth;

        // Features Data
        const featuresData = [
            { icon: 'ğŸ‘»', title: 'Ø§Ù„Ù…Ø±Ø§Ø³Ù„ Ø§Ù„Ø´Ø¨Ø­', desc: 'Ù†Ø´Ø± Ø¢Ù„ÙŠ' },
            { icon: 'ğŸ”®', title: 'Ø§Ù„ØºØ±ÙØ© Ø§Ù„ØªÙ†Ø¨Ø¤ÙŠØ©', desc: 'ØªÙˆÙ‚Ø¹ Ø§Ù„ØªØ±ÙŠÙ†Ø¯' },
            { icon: 'ğŸ“', title: 'Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±', desc: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ£Ø«ÙŠØ±' },
             // ... Add rest if needed
        ];

        function renderFeatures() {
            const grid = document.getElementById('features-grid');
            if(grid) grid.innerHTML = featuresData.map(f => `
                <div class="bg-white/5 p-4 rounded-xl border border-white/10">
                    <div class="text-2xl mb-2">${f.icon}</div>
                    <h3 class="text-white font-bold text-sm">${f.title}</h3>
                    <p class="text-gray-500 text-xs">${f.desc}</p>
                </div>
            `).join('');
        }

        // Firebase Init
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            
            auth.onAuthStateChanged(user => {
                if(user && !user.isAnonymous) {
                    document.getElementById('login-gate').classList.add('hidden');
                    document.getElementById('dashboard-ui').classList.remove('hidden');
                    loadAdminData();
                }
            });
            if(!auth.currentUser) auth.signInAnonymously().catch(()=>isOfflineMode=true);
        } catch(e) { isOfflineMode=true; }

        // News Logic
        function getLocalNews() { try { return JSON.parse(localStorage.getItem(LOCAL_NEWS_KEY) || "[]"); } catch { return []; } }
        async function fetchNews() {
            if (isOfflineMode) return renderLocal();
            try {
                const snap = await db.collection("news").limit(20).get();
                if(snap.empty) renderLocal();
                else {
                    const data = snap.docs.map(d => ({id:d.id, ...d.data()}));
                    renderSite(data);
                }
            } catch(e) { renderLocal(); }
        }
        function renderLocal() {
            const l = getLocalNews();
            if(l.length) renderSite(l);
            else {
                const m = [{id:1, title:"ØµØ­ÙŠÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ØªØ·Ù„Ù‚ Ù‡ÙˆÙŠØªÙ‡Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©", category:"Ø¹Ø§Ù…", img:"https://images.unsplash.com/photo-1504711434969-e33886168f5c", desc:"Ù†Ù‚Ù„Ø© Ù†ÙˆØ¹ÙŠØ©..."}];
                renderSite(m);
            }
        }
        function renderSite(news) {
            if(!news.length) return;
            const hero = news[0];
            const rest = news.slice(1);
            
            document.getElementById('ticker-content').innerText = "Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø°ÙƒÙŠØ© | ØªØµÙ…ÙŠÙ…: ÙŠÙˆØ³Ù Ø§Ù„Ø¹ØªÙŠ â€¢ " + news.map(n => n.title).join(" â€¢ ");
            
            document.getElementById('hero-section').innerHTML = `
                <div class="w-full h-full relative group overflow-hidden rounded-2xl cursor-pointer shadow-2xl">
                    <img src="${hero.img}" class="w-full h-full object-cover transition duration-700 group-hover:scale-105">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                    <div class="absolute bottom-0 p-8">
                        <span class="bg-gold-400 text-black text-xs font-bold px-3 py-1 rounded-full mb-3 inline-block">${hero.category}</span>
                        <h1 class="text-3xl font-bold text-white mb-2">${hero.title}</h1>
                    </div>
                </div>`;

            document.getElementById('news-container').innerHTML = rest.map(n => `
                <div class="flex gap-4 bg-white/5 p-3 rounded-xl border border-white/5 hover:border-gold-400/30 cursor-pointer transition">
                    <div class="w-24 h-24 rounded-lg overflow-hidden shrink-0"><img src="${n.img}" class="w-full h-full object-cover"></div>
                    <div class="flex flex-col justify-center"><h3 class="text-white font-bold text-sm line-clamp-2">${n.title}</h3><span class="text-[10px] text-gold-400 mt-2">${n.category}</span></div>
                </div>`).join('');
            initIcons();
        }

        // Admin Logic
        window.handleRealLogin = async (e) => {
            e.preventDefault();
            const em = document.getElementById('login-email').value;
            const ps = document.getElementById('login-password').value;
            try { await auth.signInWithEmailAndPassword(em, ps); } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„"); }
        };

        window.publishAction = async () => {
            const title = document.getElementById('news-title').value;
            const cat = document.getElementById('news-category').value;
            const content = document.getElementById('editor').value;
            const art = { id:"loc_"+Date.now(), title, category: cat, img:"https://via.placeholder.com/800", desc:content, date: new Date().toLocaleDateString('ar-SA') };
            
            try { await db.collection("news").add(art); showToast("ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ…"); }
            catch { 
                const l = getLocalNews(); l.unshift(art); localStorage.setItem(LOCAL_NEWS_KEY, JSON.stringify(l));
                showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ âš ï¸");
            }
            fetchNews();
        };

        // Navigation
        window.toggleSidebar = () => {
            document.getElementById('main-sidebar').classList.toggle('open');
            document.getElementById('sidebar-overlay').classList.toggle('hidden');
        };
        window.toggleAdminView = () => {
            const admin = document.getElementById('admin-view');
            const pub = document.getElementById('public-view');
            if(admin.classList.contains('view-hidden')) {
                admin.classList.remove('view-hidden');
                pub.classList.add('view-hidden');
            } else {
                admin.classList.add('view-hidden');
                pub.classList.remove('view-hidden');
            }
        };

        window.switchPublicView = (view, btn) => {
             // For now, this just filters news or scrolls, keeping it simple for SPA
             if(view === 'home') window.location.reload();
             // In a real app, this would filter the news array
        };

        window.switchDashView = (v, btn) => {
            document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden'));
            document.getElementById('sec-'+v).classList.remove('hidden');
            document.querySelectorAll('.sidebar-link').forEach(e => e.classList.remove('active'));
            btn.classList.add('active');
            if(v==='impact') initCharts();
        };

        window.generateInviteLink = () => {
            const id = "HQ-"+Math.floor(Math.random()*9000);
            const link = window.location.href.split('?')[0] + "?mode=recruitment&jobId="+id;
            document.getElementById('invite-box').classList.remove('hidden');
            document.getElementById('invite-link-val').value = link;
        }
        
        // Settings
        window.openSettings = () => document.getElementById('settings-modal').classList.remove('hidden');
        window.saveApiKey = () => { 
            const k = document.getElementById('api-key-input').value; 
            if(k) { localStorage.setItem("gemini_api_key", k); document.getElementById('settings-modal').classList.add('hidden'); }
        };

        function showToast(msg) {
            const t = document.getElementById('toast'); t.innerText = msg; t.classList.remove('opacity-0', 'translate-y-24');
            setTimeout(() => t.classList.add('opacity-0', 'translate-y-24'), 3000);
        }

        function initCharts() {
             const ctx = document.getElementById('predictiveChart');
             if(ctx) new Chart(ctx, { type: 'line', data: { labels: ['A','B','C'], datasets: [{ label: 'Trend', data: [10, 20, 15], borderColor: '#D4AF37' }] } });
        }
    </script>
</body>
</html>


